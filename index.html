<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compresor de Imágenes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .drag-area {
            border: 3px dashed #4a5568;
        }
        .drag-area.active {
            border-color: #3b82f6;
            background-color: #2d3748;
        }
        /* Estilos personalizados para el control deslizante (slider) */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #4a5568;
            border-radius: 5px;
            outline: none;
            transition: opacity .2s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 5px #3b82f6;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: 0 0 5px #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <!-- Título y Descripción -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-teal-400">Compresor de Imágenes</h1>
            <p class="text-gray-400 text-lg">Reduce el tamaño de tus archivos JPG y PNG directamente en tu navegador.</p>
        </div>

        <!-- Pantalla Principal: Carga de Archivos -->
        <div id="uploadScreen">
            <div id="dragArea" class="drag-area w-full p-10 text-center rounded-xl cursor-pointer transition-all duration-300 hover:bg-gray-800">
                <i class="fas fa-cloud-upload-alt text-5xl text-gray-500 mb-4"></i>
                <h2 class="text-2xl font-semibold mb-2">Arrastra y suelta tu imagen aquí</h2>
                <p class="text-gray-500">o</p>
                <button id="browseBtn" class="mt-4 bg-blue-600 hover:bg-blue-700 rounded-lg px-6 py-2 font-semibold transition duration-300">
                    Selecciona un archivo
                </button>
                <input type="file" id="fileInput" class="hidden" accept="image/jpeg, image/png">
            </div>
            <p id="uploadError" class="text-red-500 text-center mt-4 hidden">Error: Por favor, sube un archivo JPG o PNG.</p>
        </div>

        <!-- Pantalla de Resultados: Compresión -->
        <div id="resultScreen" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Imagen Original -->
                <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
                    <h3 class="font-bold text-lg mb-2 text-center">Original</h3>
                    <img id="originalImage" src="" alt="Imagen Original" class="rounded-md w-full h-auto object-contain max-h-96">
                    <p class="text-center mt-2 text-gray-400">Tamaño: <span id="originalSize" class="font-semibold text-white">0 KB</span></p>
                </div>

                <!-- Imagen Comprimida -->
                <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
                    <h3 class="font-bold text-lg mb-2 text-center">Comprimida</h3>
                    <img id="compressedImage" src="https://placehold.co/600x400/1f2937/a0aec0?text=Comprimida" alt="Imagen Comprimida" class="rounded-md w-full h-auto object-contain max-h-96">
                    <p class="text-center mt-2 text-gray-400">Tamaño: <span id="compressedSize" class="font-semibold text-white">0 KB</span></p>
                </div>
            </div>
            
            <!-- Controles y Resultados -->
            <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 mt-8">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <!-- Controles de Calidad (solo para JPG) -->
                    <div id="qualityControl" class="w-full md:w-1/2 mb-4 md:mb-0">
                        <label for="qualitySlider" class="block mb-2 font-medium">Calidad JPG: <span id="qualityValue">0.7</span></label>
                        <input type="range" id="qualitySlider" min="0.1" max="1" step="0.05" value="0.7">
                    </div>
                    
                    <!-- Información de Reducción -->
                    <div class="text-center md:text-right">
                        <p class="text-lg">Reducción de tamaño</p>
                        <p id="reductionPercentage" class="text-3xl font-bold text-green-400">0%</p>
                    </div>
                </div>

                <hr class="border-gray-700 my-6">

                <!-- Botones de Acción -->
                <div class="flex flex-col sm:flex-row gap-4">
                    <a id="downloadBtn" href="#" download="imagen-comprimida.jpg" class="flex-1 text-center bg-green-600 hover:bg-green-700 rounded-lg px-8 py-3 font-semibold transition duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-download"></i>
                        <span>Descargar</span>
                    </a>
                     <button id="startOverBtn" class="flex-1 bg-gray-600 hover:bg-gray-500 rounded-lg px-8 py-3 font-semibold transition duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-sync-alt"></i>
                        <span>Comprimir otra</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Elementos del DOM
        const uploadScreen = document.getElementById('uploadScreen');
        const resultScreen = document.getElementById('resultScreen');
        const dragArea = document.getElementById('dragArea');
        const browseBtn = document.getElementById('browseBtn');
        const fileInput = document.getElementById('fileInput');
        const uploadError = document.getElementById('uploadError');

        const originalImage = document.getElementById('originalImage');
        const compressedImage = document.getElementById('compressedImage');
        const originalSize = document.getElementById('originalSize');
        const compressedSize = document.getElementById('compressedSize');
        
        const qualityControl = document.getElementById('qualityControl');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const reductionPercentage = document.getElementById('reductionPercentage');
        
        const downloadBtn = document.getElementById('downloadBtn');
        const startOverBtn = document.getElementById('startOverBtn');

        let originalFile = null;
        let imageType = '';

        // --- Lógica para arrastrar y soltar ---
        dragArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragArea.classList.add('active');
        });

        dragArea.addEventListener('dragleave', () => {
            dragArea.classList.remove('active');
        });

        dragArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dragArea.classList.remove('active');
            const file = e.dataTransfer.files[0];
            if (file) {
                handleFile(file);
            }
        });

        // --- Lógica para el botón de selección de archivo ---
        browseBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });
        
        // --- Manejo del archivo seleccionado ---
        function handleFile(file) {
            const validTypes = ['image/jpeg', 'image/png'];
            if (!validTypes.includes(file.type)) {
                uploadError.style.display = 'block';
                return;
            }
            uploadError.style.display = 'none';
            originalFile = file;
            imageType = file.type;

            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage.src = e.target.result;
                originalSize.textContent = formatBytes(originalFile.size);
                
                // Mostrar la pantalla de resultados
                uploadScreen.style.display = 'none';
                resultScreen.style.display = 'block';

                // Ajustar controles según el tipo de imagen
                if (imageType === 'image/png') {
                    qualityControl.style.display = 'none'; // No hay control de calidad para PNG en canvas
                } else {
                    qualityControl.style.display = 'block';
                }
                
                compressImage();
            };
            reader.readAsDataURL(file);
        }

        // --- Función principal de compresión ---
        function compressImage() {
            if (!originalFile) return;

            const quality = parseFloat(qualitySlider.value);
            qualityValue.textContent = quality;

            const img = new Image();
            img.src = originalImage.src;

            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                canvas.width = img.width;
                canvas.height = img.height;

                // Dibujar la imagen en el canvas
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                // Obtener la URL de datos de la imagen comprimida.
                // Para JPEG, podemos pasar un segundo argumento 'quality'.
                // Para PNG, el navegador realiza una compresión sin pérdida por defecto.
                const compressedDataUrl = canvas.toDataURL(imageType, imageType === 'image/jpeg' ? quality : undefined);
                
                compressedImage.src = compressedDataUrl;
                
                // Actualizar la información de la UI
                updateCompressionInfo(compressedDataUrl);
            };
        }

        // --- Actualizar la información en la UI ---
        function updateCompressionInfo(dataUrl) {
            const compressedFileBlob = dataURLtoBlob(dataUrl);
            const compressedFileSize = compressedFileBlob.size;

            compressedSize.textContent = formatBytes(compressedFileSize);
            
            const reduction = 100 - (compressedFileSize / originalFile.size * 100);
            reductionPercentage.textContent = `${reduction.toFixed(1)}%`;
            
            // Actualizar el botón de descarga
            const extension = imageType.split('/')[1];
            downloadBtn.href = dataUrl;
            downloadBtn.download = `imagen-comprimida.${extension}`;
        }
        
        // --- Event Listeners para controles ---
        qualitySlider.addEventListener('input', compressImage);

        startOverBtn.addEventListener('click', () => {
            // Reiniciar el estado
            originalFile = null;
            fileInput.value = ''; // Limpiar el input de archivo
            resultScreen.style.display = 'none';
            uploadScreen.style.display = 'block';
            originalImage.src = '';
            compressedImage.src = 'https://placehold.co/600x400/1f2937/a0aec0?text=Comprimida';
            qualitySlider.value = '0.7';
        });

        // --- Funciones de utilidad ---
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }
    </script>
</body>
</html>
